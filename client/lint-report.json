[{"filePath":"C:\\Users\\reina\\antigravity\\pomodoro\\client\\eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\reina\\antigravity\\pomodoro\\client\\next.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\reina\\antigravity\\pomodoro\\client\\postcss.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\reina\\antigravity\\pomodoro\\client\\src\\app\\dashboard\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'di' is defined but never used.","line":85,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":85,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'maxCount' is assigned a value but never used.","line":152,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":152,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'formatDate' is assigned a value but never used.","line":156,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":156,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card } from \"@/components/ui/card\";\r\nimport { useApiClient } from \"@/lib/apiClient\";\r\nimport { useAuth } from \"@/components/auth/AuthProvider\";\r\nimport { ArrowLeft, Flame, Clock, Target, TrendingUp, ArrowUpRight, ArrowDownRight, Calendar } from \"lucide-react\";\r\nimport Link from \"next/link\";\r\nimport { PieChart, Pie, Cell, BarChart, Bar, XAxis, YAxis, Tooltip, ResponsiveContainer } from \"recharts\";\r\n\r\ninterface DashboardStats {\r\n  today: { pomodoros: number; minutes: number; hours: number; vsYesterday: number };\r\n  week: { pomodoros: number; minutes: number; hours: number; vsLastWeek: number };\r\n  dailyBreakdown: { date: string; count: number; minutes: number }[];\r\n  hourlyDistribution: { hour: number; count: number }[];\r\n  taskDistribution: { name: string; value: number; minutes: number }[];\r\n  heatmapData: { date: string; count: number }[];\r\n  streak: number;\r\n  topTasks: { id: number; title: string; count: number }[];\r\n  recentSessions: {\r\n    id: number;\r\n    type: string;\r\n    duration: number;\r\n    completedAt: string;\r\n    task: { id: number; title: string } | null;\r\n  }[];\r\n}\r\n\r\nconst COLORS = ['#f43f5e', '#14b8a6', '#3b82f6', '#f59e0b', '#8b5cf6', '#ec4899', '#22c55e', '#06b6d4'];\r\n\r\n// Comparison indicator component\r\nfunction ComparisonBadge({ value, label }: { value: number; label: string }) {\r\n  if (value === 0) return null;\r\n  const isPositive = value > 0;\r\n  return (\r\n    <span className={`text-xs flex items-center gap-0.5 ${isPositive ? 'text-green-500' : 'text-red-500'}`}>\r\n      {isPositive ? <ArrowUpRight className=\"h-3 w-3\" /> : <ArrowDownRight className=\"h-3 w-3\" />}\r\n      {Math.abs(value)}% {label}\r\n    </span>\r\n  );\r\n}\r\n\r\n// Heatmap component\r\nfunction ActivityHeatmap({ data }: { data: { date: string; count: number }[] }) {\r\n  const maxCount = Math.max(...data.map(d => d.count), 1);\r\n  \r\n  const getColor = (count: number) => {\r\n    if (count === 0) return 'bg-muted/30';\r\n    const intensity = Math.min(count / maxCount, 1);\r\n    if (intensity < 0.25) return 'bg-rose-500/30';\r\n    if (intensity < 0.5) return 'bg-rose-500/50';\r\n    if (intensity < 0.75) return 'bg-rose-500/70';\r\n    return 'bg-rose-500';\r\n  };\r\n\r\n  // Group by weeks (7 days per column)\r\n  const weeks: { date: string; count: number }[][] = [];\r\n  for (let i = 0; i < data.length; i += 7) {\r\n    weeks.push(data.slice(i, i + 7));\r\n  }\r\n\r\n  const monthLabels: { label: string; weekIndex: number }[] = [];\r\n  let lastMonth = '';\r\n  data.forEach((d, i) => {\r\n    const month = new Date(d.date).toLocaleDateString('en-US', { month: 'short' });\r\n    if (month !== lastMonth) {\r\n      monthLabels.push({ label: month, weekIndex: Math.floor(i / 7) });\r\n      lastMonth = month;\r\n    }\r\n  });\r\n\r\n  return (\r\n    <div className=\"space-y-2\">\r\n      <div className=\"flex gap-0.5 text-xs text-muted-foreground pl-4\">\r\n        {monthLabels.map((m, i) => (\r\n          <span key={i} style={{ marginLeft: i === 0 ? 0 : `${(m.weekIndex - (monthLabels[i-1]?.weekIndex || 0) - 1) * 12}px` }}>\r\n            {m.label}\r\n          </span>\r\n        ))}\r\n      </div>\r\n      <div className=\"flex gap-0.5 overflow-x-auto pb-2\">\r\n        {weeks.map((week, wi) => (\r\n          <div key={wi} className=\"flex flex-col gap-0.5\">\r\n            {week.map((day, di) => (\r\n              <div\r\n                key={day.date}\r\n                className={`w-3 h-3 rounded-sm ${getColor(day.count)} transition-colors`}\r\n                title={`${day.date}: ${day.count} pomodoros`}\r\n              />\r\n            ))}\r\n          </div>\r\n        ))}\r\n      </div>\r\n      <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\r\n        <span>Less</span>\r\n        <div className=\"flex gap-0.5\">\r\n          <div className=\"w-3 h-3 rounded-sm bg-muted/30\" />\r\n          <div className=\"w-3 h-3 rounded-sm bg-rose-500/30\" />\r\n          <div className=\"w-3 h-3 rounded-sm bg-rose-500/50\" />\r\n          <div className=\"w-3 h-3 rounded-sm bg-rose-500/70\" />\r\n          <div className=\"w-3 h-3 rounded-sm bg-rose-500\" />\r\n        </div>\r\n        <span>More</span>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function Dashboard() {\r\n  const { user, loading } = useAuth();\r\n  const apiClient = useApiClient();\r\n  const [stats, setStats] = useState<DashboardStats | null>(null);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [dateRange, setDateRange] = useState('7days');\r\n\r\n  useEffect(() => {\r\n    if (!user) return;\r\n    \r\n    const fetchStats = async () => {\r\n      try {\r\n        const response = await apiClient.get(`/sessions/stats?range=${dateRange}`);\r\n        setStats(response.data);\r\n      } catch (err) {\r\n        console.error('Failed to fetch stats:', err);\r\n        setError('Failed to load dashboard data');\r\n      }\r\n    };\r\n    \r\n    fetchStats();\r\n  }, [user, apiClient, dateRange]);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-background via-background/90 to-primary/5\">\r\n        <div className=\"animate-pulse text-muted-foreground\">Loading...</div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!user) {\r\n    return (\r\n      <div className=\"min-h-screen flex flex-col items-center justify-center bg-gradient-to-br from-background via-background/90 to-primary/5\">\r\n        <h2 className=\"text-xl font-semibold mb-4\">Please log in to view your dashboard</h2>\r\n        <Link href=\"/\">\r\n          <Button>Go to Home</Button>\r\n        </Link>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const maxCount = stats?.dailyBreakdown \r\n    ? Math.max(...stats.dailyBreakdown.map(d => d.count), 1) \r\n    : 1;\r\n\r\n  const formatDate = (dateStr: string) => {\r\n    const date = new Date(dateStr);\r\n    return date.toLocaleDateString('en-US', { weekday: 'short' });\r\n  };\r\n\r\n  const formatHour = (hour: number) => {\r\n    if (hour === 0) return '12am';\r\n    if (hour === 12) return '12pm';\r\n    return hour < 12 ? `${hour}am` : `${hour - 12}pm`;\r\n  };\r\n\r\n  return (\r\n    <main className=\"min-h-screen flex flex-col bg-gradient-to-br from-background via-background/90 to-primary/5 text-foreground\">\r\n      {/* Header */}\r\n      <header className=\"w-full flex items-center justify-between p-6 max-w-6xl mx-auto\">\r\n        <Link href=\"/\" className=\"flex items-center space-x-2 text-muted-foreground hover:text-foreground transition-colors\">\r\n          <ArrowLeft className=\"h-5 w-5\" />\r\n          <span>Back to Timer</span>\r\n        </Link>\r\n        <h1 className=\"text-xl font-bold tracking-tighter\">Dashboard</h1>\r\n        <select\r\n          value={dateRange}\r\n          onChange={(e) => setDateRange(e.target.value)}\r\n          className=\"bg-secondary border border-border rounded-md px-3 py-1.5 text-sm\"\r\n        >\r\n          <option value=\"7days\">Last 7 Days</option>\r\n          <option value=\"30days\">Last 30 Days</option>\r\n          <option value=\"month\">This Month</option>\r\n          <option value=\"year\">This Year</option>\r\n          <option value=\"all\">All Time</option>\r\n        </select>\r\n      </header>\r\n\r\n      <div className=\"flex-1 w-full max-w-6xl mx-auto px-6 pb-12 space-y-6\">\r\n        {error ? (\r\n          <div className=\"text-center p-8 text-destructive\">{error}</div>\r\n        ) : !stats || !stats.today || !stats.week ? (\r\n          <div className=\"text-center p-8 text-muted-foreground animate-pulse\">Loading stats...</div>\r\n        ) : (\r\n          <>\r\n            {/* Summary Cards */}\r\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n              <Card className=\"p-4 bg-card/50 backdrop-blur-sm border-border/50\">\r\n                <div className=\"flex items-center space-x-3\">\r\n                  <div className=\"p-2 rounded-full bg-rose-500/10\">\r\n                    <Target className=\"h-5 w-5 text-rose-500\" />\r\n                  </div>\r\n                  <div>\r\n                    <p className=\"text-2xl font-bold\">{stats.today.pomodoros}</p>\r\n                    <p className=\"text-xs text-muted-foreground\">Today</p>\r\n                    <ComparisonBadge value={stats.today.vsYesterday} label=\"vs yesterday\" />\r\n                  </div>\r\n                </div>\r\n              </Card>\r\n\r\n              <Card className=\"p-4 bg-card/50 backdrop-blur-sm border-border/50\">\r\n                <div className=\"flex items-center space-x-3\">\r\n                  <div className=\"p-2 rounded-full bg-teal-500/10\">\r\n                    <TrendingUp className=\"h-5 w-5 text-teal-500\" />\r\n                  </div>\r\n                  <div>\r\n                    <p className=\"text-2xl font-bold\">{stats.week.pomodoros}</p>\r\n                    <p className=\"text-xs text-muted-foreground\">This Week</p>\r\n                    <ComparisonBadge value={stats.week.vsLastWeek} label=\"vs last week\" />\r\n                  </div>\r\n                </div>\r\n              </Card>\r\n\r\n              <Card className=\"p-4 bg-card/50 backdrop-blur-sm border-border/50\">\r\n                <div className=\"flex items-center space-x-3\">\r\n                  <div className=\"p-2 rounded-full bg-blue-500/10\">\r\n                    <Clock className=\"h-5 w-5 text-blue-500\" />\r\n                  </div>\r\n                  <div>\r\n                    <p className=\"text-2xl font-bold\">{stats.week.hours}h</p>\r\n                    <p className=\"text-xs text-muted-foreground\">Focus Time</p>\r\n                  </div>\r\n                </div>\r\n              </Card>\r\n\r\n              <Card className=\"p-4 bg-card/50 backdrop-blur-sm border-border/50\">\r\n                <div className=\"flex items-center space-x-3\">\r\n                  <div className=\"p-2 rounded-full bg-orange-500/10\">\r\n                    <Flame className=\"h-5 w-5 text-orange-500\" />\r\n                  </div>\r\n                  <div>\r\n                    <p className=\"text-2xl font-bold\">{stats.streak}</p>\r\n                    <p className=\"text-xs text-muted-foreground\">Day Streak ≡ƒöÑ</p>\r\n                  </div>\r\n                </div>\r\n              </Card>\r\n            </div>\r\n\r\n            {/* Charts Row */}\r\n            <div className=\"grid md:grid-cols-2 gap-6\">\r\n              {/* Peak Hours Chart */}\r\n              <Card className=\"p-6 bg-card/50 backdrop-blur-sm border-border/50\">\r\n                <h2 className=\"text-lg font-semibold mb-4\">Peak Productivity Hours</h2>\r\n                <ResponsiveContainer width=\"100%\" height={200}>\r\n                  <BarChart data={stats.hourlyDistribution}>\r\n                    <XAxis \r\n                      dataKey=\"hour\" \r\n                      tickFormatter={formatHour}\r\n                      tick={{ fontSize: 10 }}\r\n                      interval={2}\r\n                    />\r\n                    <YAxis hide />\r\n                    <Tooltip \r\n                      formatter={(value?: number) => [`${value ?? 0} pomodoros`, 'Count']}\r\n                      labelFormatter={(hour?: number) => formatHour(hour ?? 0)}\r\n                      contentStyle={{ background: 'hsl(var(--card))', border: '1px solid hsl(var(--border))' }}\r\n                    />\r\n                    <Bar dataKey=\"count\" fill=\"#f43f5e\" radius={[4, 4, 0, 0]} />\r\n                  </BarChart>\r\n                </ResponsiveContainer>\r\n              </Card>\r\n\r\n              {/* Task Distribution Donut */}\r\n              <Card className=\"p-6 bg-card/50 backdrop-blur-sm border-border/50\">\r\n                <h2 className=\"text-lg font-semibold mb-4\">Task Distribution</h2>\r\n                {stats.taskDistribution.length === 0 ? (\r\n                  <div className=\"h-[200px] flex items-center justify-center text-muted-foreground\">\r\n                    No tasks tracked yet\r\n                  </div>\r\n                ) : (\r\n                  <div className=\"flex items-center gap-4\">\r\n                    <ResponsiveContainer width={140} height={140}>\r\n                      <PieChart>\r\n                        <Pie\r\n                          data={stats.taskDistribution}\r\n                          innerRadius={45}\r\n                          outerRadius={65}\r\n                          paddingAngle={2}\r\n                          dataKey=\"value\"\r\n                        >\r\n                          {stats.taskDistribution.map((entry, index) => (\r\n                            <Cell key={entry.name} fill={COLORS[index % COLORS.length]} />\r\n                          ))}\r\n                        </Pie>\r\n                        <Tooltip \r\n                          formatter={(value?: number, name?: string) => [`${value ?? 0} pomodoros`, name ?? '']}\r\n                          contentStyle={{ background: 'hsl(var(--card))', border: '1px solid hsl(var(--border))' }}\r\n                        />\r\n                      </PieChart>\r\n                    </ResponsiveContainer>\r\n                    <div className=\"flex-1 space-y-1 max-h-[140px] overflow-y-auto\">\r\n                      {stats.taskDistribution.map((task, i) => (\r\n                        <div key={task.name} className=\"flex items-center gap-2 text-sm\">\r\n                          <div className=\"w-3 h-3 rounded-full\" style={{ backgroundColor: COLORS[i % COLORS.length] }} />\r\n                          <span className=\"truncate flex-1\">{task.name}</span>\r\n                          <span className=\"text-muted-foreground\">{task.value}</span>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </Card>\r\n            </div>\r\n\r\n            {/* Yearly Heatmap */}\r\n            <Card className=\"p-6 bg-card/50 backdrop-blur-sm border-border/50\">\r\n              <div className=\"flex items-center gap-2 mb-4\">\r\n                <Calendar className=\"h-5 w-5 text-muted-foreground\" />\r\n                <h2 className=\"text-lg font-semibold\">Activity Heatmap</h2>\r\n                <span className=\"text-sm text-muted-foreground\">(Last 365 days)</span>\r\n              </div>\r\n              <ActivityHeatmap data={stats.heatmapData} />\r\n            </Card>\r\n\r\n            {/* Two Column Layout */}\r\n            <div className=\"grid md:grid-cols-2 gap-6\">\r\n              {/* Top Tasks */}\r\n              <Card className=\"p-6 bg-card/50 backdrop-blur-sm border-border/50\">\r\n                <h2 className=\"text-lg font-semibold mb-4\">Top Tasks</h2>\r\n                {stats.topTasks.length === 0 ? (\r\n                  <p className=\"text-sm text-muted-foreground\">No tasks tracked yet</p>\r\n                ) : (\r\n                  <div className=\"space-y-3\">\r\n                    {stats.topTasks.map((task, i) => (\r\n                      <div key={i} className=\"flex items-center justify-between\">\r\n                        <div className=\"flex items-center space-x-3\">\r\n                          <span className=\"text-sm font-medium text-muted-foreground w-5\">{i + 1}.</span>\r\n                          <span className=\"text-sm truncate max-w-[180px]\">{task.title}</span>\r\n                        </div>\r\n                        <span className=\"text-sm font-medium text-rose-500\">{task.count} ≡ƒìà</span>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n              </Card>\r\n\r\n              {/* Recent Sessions */}\r\n              <Card className=\"p-6 bg-card/50 backdrop-blur-sm border-border/50\">\r\n                <h2 className=\"text-lg font-semibold mb-4\">Recent Sessions</h2>\r\n                {stats.recentSessions.length === 0 ? (\r\n                  <p className=\"text-sm text-muted-foreground\">No sessions recorded yet</p>\r\n                ) : (\r\n                  <div className=\"space-y-3 max-h-60 overflow-y-auto\">\r\n                    {stats.recentSessions.map((session) => (\r\n                      <div key={session.id} className=\"flex items-center justify-between text-sm\">\r\n                        <div className=\"flex items-center space-x-2\">\r\n                          <span className={`w-2 h-2 rounded-full ${\r\n                            session.type === 'pomodoro' ? 'bg-rose-500' : \r\n                            session.type === 'shortBreak' ? 'bg-teal-500' : 'bg-blue-500'\r\n                          }`} />\r\n                          <span className=\"truncate max-w-[140px]\">\r\n                            {session.task?.title || (session.type === 'pomodoro' ? 'Focus' : session.type === 'shortBreak' ? 'Short Break' : 'Long Break')}\r\n                          </span>\r\n                        </div>\r\n                        <div className=\"flex items-center space-x-3 text-muted-foreground\">\r\n                          <span>{session.duration}m</span>\r\n                          <span>{new Date(session.completedAt).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}</span>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n              </Card>\r\n            </div>\r\n          </>\r\n        )}\r\n      </div>\r\n    </main>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\reina\\antigravity\\pomodoro\\client\\src\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\reina\\antigravity\\pomodoro\\client\\src\\app\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\reina\\antigravity\\pomodoro\\client\\src\\components\\SettingsDialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isDark' is assigned a value but never used.","line":168,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":168,"endColumn":17},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\reina\\antigravity\\pomodoro\\client\\src\\components\\SettingsDialog.tsx:179:9\n  177 |       try {\n  178 |         const parsed = JSON.parse(saved);\n> 179 |         setSettings(parsed);\n      |         ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  180 |         setTempSettings(parsed);\n  181 |       } catch (e) {\n  182 |         console.error('Failed to parse saved settings', e);","line":179,"column":9,"nodeType":null,"endLine":179,"endColumn":20}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\r\nimport { Settings, Palette, Volume2 } from \"lucide-react\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { useTheme } from \"@/components/ThemeProvider\";\r\nimport { ALARM_SOUNDS, AlarmSound, playAlarmSound } from \"@/lib/alarmSounds\";\r\n\r\ninterface TimerSettings {\r\n  pomodoro: number;\r\n  shortBreak: number;\r\n  longBreak: number;\r\n}\r\n\r\ninterface AlarmSettings {\r\n  pomodoro: AlarmSound;\r\n  shortBreak: AlarmSound;\r\n  longBreak: AlarmSound;\r\n}\r\n\r\nconst DEFAULT_SETTINGS: TimerSettings = {\r\n  pomodoro: 25 * 60,\r\n  shortBreak: 5 * 60,\r\n  longBreak: 15 * 60,\r\n};\r\n\r\nconst DEFAULT_ALARMS: AlarmSettings = {\r\n  pomodoro: 'beep',\r\n  shortBreak: 'chime',\r\n  longBreak: 'bell',\r\n};\r\n\r\nconst toMinSec = (totalSeconds: number) => ({\r\n  min: Math.floor(totalSeconds / 60),\r\n  sec: totalSeconds % 60,\r\n});\r\n\r\nconst toSeconds = (min: number, sec: number) => min * 60 + sec;\r\n\r\n// Duration input that allows empty values during editing\r\nfunction DurationInput({ \r\n  value, \r\n  onChange, \r\n  max,\r\n  label\r\n}: { \r\n  value: number; \r\n  onChange: (val: number) => void; \r\n  max: number;\r\n  label: string;\r\n}) {\r\n  const [displayValue, setDisplayValue] = useState(value.toString());\r\n  \r\n  // Sync display value when prop changes\r\n  useEffect(() => {\r\n    setDisplayValue(value.toString());\r\n  }, [value]);\r\n  \r\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const raw = e.target.value;\r\n    // Allow empty string during editing\r\n    if (raw === '') {\r\n      setDisplayValue('');\r\n      return;\r\n    }\r\n    const num = parseInt(raw, 10);\r\n    if (!isNaN(num)) {\r\n      const clamped = Math.max(0, Math.min(max, num));\r\n      setDisplayValue(raw);\r\n      onChange(clamped);\r\n    }\r\n  };\r\n  \r\n  const handleBlur = () => {\r\n    // On blur, if empty, set to 0\r\n    if (displayValue === '' || isNaN(parseInt(displayValue, 10))) {\r\n      setDisplayValue('0');\r\n      onChange(0);\r\n    } else {\r\n      const num = Math.max(0, Math.min(max, parseInt(displayValue, 10)));\r\n      setDisplayValue(num.toString());\r\n      onChange(num);\r\n    }\r\n  };\r\n  \r\n  return (\r\n    <>\r\n      <Input \r\n        type=\"number\" \r\n        min={0} \r\n        max={max}\r\n        value={displayValue}\r\n        onChange={handleChange}\r\n        onBlur={handleBlur}\r\n        className=\"w-20\"\r\n      />\r\n      <span className=\"text-sm text-muted-foreground\">{label}</span>\r\n    </>\r\n  );\r\n}\r\n\r\n// Color picker component\r\nfunction ColorSlider({ label, hue, onChange }: { label: string; hue: string; onChange: (hue: string) => void }) {\r\n  return (\r\n    <div className=\"space-y-2\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <span className=\"text-sm font-medium flex items-center\">\r\n          <span className=\"w-4 h-4 rounded-full mr-2 border border-white/20\" style={{ backgroundColor: `hsl(${hue}, 70%, 55%)` }} />\r\n          {label}\r\n        </span>\r\n      </div>\r\n      <input\r\n        type=\"range\" min=\"0\" max=\"360\" value={hue}\r\n        onChange={(e) => onChange(e.target.value)}\r\n        className=\"w-full h-6 rounded-lg cursor-pointer appearance-none\"\r\n        style={{\r\n          background: `linear-gradient(to right, hsl(0, 70%, 55%), hsl(60, 70%, 55%), hsl(120, 70%, 55%), \r\n            hsl(180, 70%, 55%), hsl(240, 70%, 55%), hsl(300, 70%, 55%), hsl(360, 70%, 55%))`,\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\n// Sound selector with preview\r\nfunction SoundSelector({ \r\n  label, \r\n  value, \r\n  onChange,\r\n  colorHue \r\n}: { \r\n  label: string; \r\n  value: AlarmSound; \r\n  onChange: (sound: AlarmSound) => void;\r\n  colorHue: string;\r\n}) {\r\n  const handlePreview = () => {\r\n    playAlarmSound(value);\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex items-center justify-between py-2\">\r\n      <label className=\"text-sm font-medium flex items-center\">\r\n        <span className=\"w-3 h-3 rounded-full mr-2\" style={{ backgroundColor: `hsl(${colorHue}, 70%, 55%)` }} />\r\n        {label}\r\n      </label>\r\n      <div className=\"flex items-center gap-2\">\r\n        <select\r\n          value={value}\r\n          onChange={(e) => onChange(e.target.value as AlarmSound)}\r\n          className=\"bg-secondary border border-border rounded-md px-3 py-1 text-sm\"\r\n        >\r\n          {ALARM_SOUNDS.map((sound) => (\r\n            <option key={sound.value} value={sound.value}>{sound.label}</option>\r\n          ))}\r\n        </select>\r\n        <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" onClick={handlePreview}>\r\n          <Volume2 className=\"h-4 w-4\" />\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport function SettingsDialog() {\r\n  const { isDark, modeColors, setModeColor } = useTheme();\r\n  const [settings, setSettings] = useState<TimerSettings>(DEFAULT_SETTINGS);\r\n  const [tempSettings, setTempSettings] = useState<TimerSettings>(DEFAULT_SETTINGS);\r\n  const [alarmSettings, setAlarmSettings] = useState<AlarmSettings>(DEFAULT_ALARMS);\r\n  const [settingsOpen, setSettingsOpen] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const saved = localStorage.getItem('timerSettings');\r\n    if (saved) {\r\n      try {\r\n        const parsed = JSON.parse(saved);\r\n        setSettings(parsed);\r\n        setTempSettings(parsed);\r\n      } catch (e) {\r\n        console.error('Failed to parse saved settings', e);\r\n      }\r\n    }\r\n    const savedAlarms = localStorage.getItem('alarmSettings');\r\n    if (savedAlarms) {\r\n      try {\r\n        setAlarmSettings({ ...DEFAULT_ALARMS, ...JSON.parse(savedAlarms) });\r\n      } catch (e) {\r\n        console.error('Failed to parse alarm settings', e);\r\n      }\r\n    }\r\n  }, []);\r\n\r\n  const saveSettings = () => {\r\n    setSettings(tempSettings);\r\n    localStorage.setItem('timerSettings', JSON.stringify(tempSettings));\r\n    localStorage.setItem('alarmSettings', JSON.stringify(alarmSettings));\r\n    setSettingsOpen(false);\r\n    window.dispatchEvent(new CustomEvent('settingsChanged'));\r\n  };\r\n\r\n  const openSettings = () => {\r\n    setTempSettings(settings);\r\n    setSettingsOpen(true);\r\n  };\r\n\r\n  const updateAlarm = (mode: keyof AlarmSettings, sound: AlarmSound) => {\r\n    setAlarmSettings(prev => ({ ...prev, [mode]: sound }));\r\n  };\r\n\r\n  const resetToDefaults = () => {\r\n    setTempSettings(DEFAULT_SETTINGS);\r\n    setAlarmSettings(DEFAULT_ALARMS);\r\n    // Reset colors to defaults\r\n    setModeColor('pomodoro', '350');\r\n    setModeColor('shortBreak', '160');\r\n    setModeColor('longBreak', '210');\r\n  };\r\n\r\n  return (\r\n    <Dialog open={settingsOpen} onOpenChange={(open) => !open && setSettingsOpen(false)}>\r\n      <DialogTrigger asChild>\r\n        <Button variant=\"ghost\" size=\"sm\" onClick={openSettings} className=\"flex items-center space-x-1\">\r\n          <Settings className=\"h-4 w-4\" />\r\n          <span>Settings</span>\r\n        </Button>\r\n      </DialogTrigger>\r\n      <DialogContent className=\"max-h-[85vh] overflow-y-auto\">\r\n        <DialogHeader>\r\n          <DialogTitle>Settings</DialogTitle>\r\n        </DialogHeader>\r\n        <div className=\"space-y-6 py-4\">\r\n          {/* Timer Durations */}\r\n          <div>\r\n            <p className=\"text-sm font-medium mb-4\">Timer Durations</p>\r\n            \r\n            <div className=\"space-y-2 mb-4\">\r\n              <label className=\"text-sm font-medium flex items-center\">\r\n                <span className=\"w-3 h-3 rounded-full mr-2\" style={{ backgroundColor: `hsl(${modeColors.pomodoro}, 70%, 55%)` }} />\r\n                Pomodoro\r\n              </label>\r\n              <div className=\"flex gap-2 items-center\">\r\n                <DurationInput \r\n                  value={toMinSec(tempSettings.pomodoro).min}\r\n                  onChange={(val) => setTempSettings({ ...tempSettings, pomodoro: toSeconds(val, toMinSec(tempSettings.pomodoro).sec) })}\r\n                  max={60}\r\n                  label=\"min\"\r\n                />\r\n                <DurationInput \r\n                  value={toMinSec(tempSettings.pomodoro).sec}\r\n                  onChange={(val) => setTempSettings({ ...tempSettings, pomodoro: toSeconds(toMinSec(tempSettings.pomodoro).min, val) })}\r\n                  max={59}\r\n                  label=\"sec\"\r\n                />\r\n              </div>\r\n            </div>\r\n            \r\n            <div className=\"space-y-2 mb-4\">\r\n              <label className=\"text-sm font-medium flex items-center\">\r\n                <span className=\"w-3 h-3 rounded-full mr-2\" style={{ backgroundColor: `hsl(${modeColors.shortBreak}, 70%, 55%)` }} />\r\n                Short Break\r\n              </label>\r\n              <div className=\"flex gap-2 items-center\">\r\n                <DurationInput \r\n                  value={toMinSec(tempSettings.shortBreak).min}\r\n                  onChange={(val) => setTempSettings({ ...tempSettings, shortBreak: toSeconds(val, toMinSec(tempSettings.shortBreak).sec) })}\r\n                  max={30}\r\n                  label=\"min\"\r\n                />\r\n                <DurationInput \r\n                  value={toMinSec(tempSettings.shortBreak).sec}\r\n                  onChange={(val) => setTempSettings({ ...tempSettings, shortBreak: toSeconds(toMinSec(tempSettings.shortBreak).min, val) })}\r\n                  max={59}\r\n                  label=\"sec\"\r\n                />\r\n              </div>\r\n            </div>\r\n            \r\n            <div className=\"space-y-2\">\r\n              <label className=\"text-sm font-medium flex items-center\">\r\n                <span className=\"w-3 h-3 rounded-full mr-2\" style={{ backgroundColor: `hsl(${modeColors.longBreak}, 70%, 55%)` }} />\r\n                Long Break\r\n              </label>\r\n              <div className=\"flex gap-2 items-center\">\r\n                <DurationInput \r\n                  value={toMinSec(tempSettings.longBreak).min}\r\n                  onChange={(val) => setTempSettings({ ...tempSettings, longBreak: toSeconds(val, toMinSec(tempSettings.longBreak).sec) })}\r\n                  max={60}\r\n                  label=\"min\"\r\n                />\r\n                <DurationInput \r\n                  value={toMinSec(tempSettings.longBreak).sec}\r\n                  onChange={(val) => setTempSettings({ ...tempSettings, longBreak: toSeconds(toMinSec(tempSettings.longBreak).min, val) })}\r\n                  max={59}\r\n                  label=\"sec\"\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Alarm Sounds */}\r\n          <div className=\"border-t border-border pt-4\">\r\n            <p className=\"text-sm font-medium mb-4 flex items-center\">\r\n              <Volume2 className=\"h-4 w-4 mr-2\" />\r\n              Alarm Sounds\r\n            </p>\r\n            <SoundSelector label=\"Pomodoro\" value={alarmSettings.pomodoro} onChange={(s) => updateAlarm('pomodoro', s)} colorHue={modeColors.pomodoro} />\r\n            <SoundSelector label=\"Short Break\" value={alarmSettings.shortBreak} onChange={(s) => updateAlarm('shortBreak', s)} colorHue={modeColors.shortBreak} />\r\n            <SoundSelector label=\"Long Break\" value={alarmSettings.longBreak} onChange={(s) => updateAlarm('longBreak', s)} colorHue={modeColors.longBreak} />\r\n          </div>\r\n\r\n          {/* Appearance */}\r\n          <div className=\"border-t border-border pt-4\">\r\n            <p className=\"text-sm font-medium mb-4 flex items-center\">\r\n              <Palette className=\"h-4 w-4 mr-2\" />\r\n              Appearance\r\n            </p>\r\n            \r\n            <div className=\"space-y-4\">\r\n              <p className=\"text-sm text-muted-foreground\">Timer Colors</p>\r\n              <ColorSlider label=\"Pomodoro Color\" hue={modeColors.pomodoro} onChange={(hue) => setModeColor('pomodoro', hue)} />\r\n              <ColorSlider label=\"Short Break Color\" hue={modeColors.shortBreak} onChange={(hue) => setModeColor('shortBreak', hue)} />\r\n              <ColorSlider label=\"Long Break Color\" hue={modeColors.longBreak} onChange={(hue) => setModeColor('longBreak', hue)} />\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"flex gap-2\">\r\n            <Button variant=\"outline\" onClick={resetToDefaults} className=\"flex-1\">Reset to Defaults</Button>\r\n            <Button onClick={saveSettings} className=\"flex-1\">Save Settings</Button>\r\n          </div>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\reina\\antigravity\\pomodoro\\client\\src\\components\\TaskList.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\reina\\antigravity\\pomodoro\\client\\src\\components\\TaskList.tsx:44:5\n  42 |\n  43 |   useEffect(() => {\n> 44 |     fetchTasks();\n     |     ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  45 |   }, [apiClient]);\n  46 |\n  47 |   const startEditing = (task: Task) => {","line":44,"column":5,"nodeType":null,"endLine":44,"endColumn":15},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchTasks'. Either include it or remove the dependency array.","line":45,"column":6,"nodeType":"ArrayExpression","endLine":45,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [apiClient, fetchTasks]","fix":{"range":[1383,1394],"text":"[apiClient, fetchTasks]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card } from \"@/components/ui/card\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\r\nimport { Check, Plus, Trash, Edit2 } from \"lucide-react\";\r\nimport { useApiClient } from \"@/lib/apiClient\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\ninterface Task {\r\n  id: number;\r\n  title: string;\r\n  completed: boolean;\r\n  estPomodoros: number;\r\n  actPomodoros: number;\r\n  note?: string;\r\n}\r\n\r\ninterface TaskListProps {\r\n  activeTask: Task | null;\r\n  onActiveTaskChange: (task: Task | null) => void;\r\n}\r\n\r\nexport function TaskList({ activeTask, onActiveTaskChange }: TaskListProps) {\r\n  const apiClient = useApiClient();\r\n  const [tasks, setTasks] = useState<Task[]>([]);\r\n  const [editingTask, setEditingTask] = useState<Task | null>(null);\r\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\r\n  const [newTaskTitle, setNewTaskTitle] = useState(\"\");\r\n  const [newTaskEst, setNewTaskEst] = useState(1);\r\n\r\n  const fetchTasks = async () => {\r\n    try {\r\n      const res = await apiClient.get('/tasks');\r\n      setTasks(res.data);\r\n    } catch (err) {\r\n      console.error(\"Failed to fetch tasks\", err);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchTasks();\r\n  }, [apiClient]);\r\n\r\n  const startEditing = (task: Task) => {\r\n    setEditingTask(task);\r\n    setNewTaskTitle(task.title);\r\n    setNewTaskEst(task.estPomodoros);\r\n    setIsDialogOpen(true);\r\n  };\r\n\r\n  const saveTask = async () => {\r\n    if (!newTaskTitle.trim()) return;\r\n    \r\n    try {\r\n      if (editingTask) {\r\n        // Update existing\r\n        await apiClient.put(`/tasks/${editingTask.id}`, {\r\n          title: newTaskTitle,\r\n          estPomodoros: newTaskEst,\r\n        });\r\n        setTasks(tasks.map(t => t.id === editingTask.id ? { ...t, title: newTaskTitle, estPomodoros: newTaskEst } : t));\r\n      } else {\r\n        // Create new\r\n        await apiClient.post('/tasks', {\r\n          title: newTaskTitle,\r\n          estPomodoros: newTaskEst\r\n        });\r\n        fetchTasks();\r\n      }\r\n      closeDialog();\r\n    } catch (err) {\r\n      console.error(\"Failed to save task\", err);\r\n    }\r\n  };\r\n\r\n  const toggleTask = async (task: Task) => {\r\n    try {\r\n      await apiClient.put(`/tasks/${task.id}`, {\r\n        completed: !task.completed\r\n      });\r\n      setTasks(tasks.map(t => t.id === task.id ? { ...t, completed: !t.completed } : t));\r\n    } catch (err) {\r\n      console.error(\"Failed to toggle task\", err);\r\n    }\r\n  };\r\n\r\n  const deleteTask = async (id: number) => {\r\n    try {\r\n      await apiClient.delete(`/tasks/${id}`);\r\n      setTasks(tasks.filter(t => t.id !== id));\r\n      if (activeTask?.id === id) onActiveTaskChange(null);\r\n    } catch (err) {\r\n      console.error(\"Failed to delete task\", err);\r\n    }\r\n  };\r\n\r\n  const closeDialog = () => {\r\n    setIsDialogOpen(false);\r\n    setEditingTask(null);\r\n    setNewTaskTitle(\"\");\r\n    setNewTaskEst(1);\r\n  };\r\n\r\n  return (\r\n    <div className=\"w-full max-w-md mx-auto space-y-4\">\r\n      {/* Task Header - More Prominent */}\r\n      <Card className=\"p-4 bg-gradient-to-r from-primary/20 to-primary/5 border-primary/30 backdrop-blur-md\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <div>\r\n            <h2 className=\"text-xl font-bold tracking-tight flex items-center gap-2\">\r\n              ≡ƒôï Tasks\r\n            </h2>\r\n            <p className=\"text-sm text-muted-foreground mt-1\">\r\n              Select a task before starting the timer\r\n            </p>\r\n          </div>\r\n          <Dialog open={isDialogOpen} onOpenChange={(open) => !open && closeDialog()}>\r\n            <DialogTrigger asChild>\r\n              <Button \r\n                size=\"sm\" \r\n                className=\"bg-primary hover:bg-primary/90 text-primary-foreground\"\r\n                onClick={() => setIsDialogOpen(true)}\r\n              >\r\n                <Plus className=\"h-4 w-4 mr-2\" />\r\n                Add Task\r\n              </Button>\r\n            </DialogTrigger>\r\n            <DialogContent>\r\n              <DialogHeader>\r\n                <DialogTitle>{editingTask ? 'Edit Task' : 'Add New Task'}</DialogTitle>\r\n              </DialogHeader>\r\n              <div className=\"space-y-4 py-4\">\r\n                <Input \r\n                  placeholder=\"What are you working on?\" \r\n                  value={newTaskTitle}\r\n                  onChange={(e) => setNewTaskTitle(e.target.value)}\r\n                  autoFocus\r\n                />\r\n                <div className=\"flex items-center space-x-2\">\r\n                  <span className=\"text-sm font-medium\">Est Pomodoros</span>\r\n                  <Input \r\n                    type=\"number\" \r\n                    min={1} \r\n                    max={10} \r\n                    value={newTaskEst}\r\n                    onChange={(e) => setNewTaskEst(Number(e.target.value))}\r\n                    className=\"w-20\"\r\n                  />\r\n                </div>\r\n                <Button onClick={saveTask} className=\"w-full\">Save</Button>\r\n              </div>\r\n            </DialogContent>\r\n          </Dialog>\r\n        </div>\r\n      </Card>\r\n\r\n      {/* Active Task Indicator */}\r\n      {activeTask && (\r\n        <Card className=\"p-4 bg-green-500/10 border-green-500/30 backdrop-blur-md\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <div className=\"h-3 w-3 rounded-full bg-green-500 animate-pulse\" />\r\n            <div className=\"text-sm font-medium text-green-600 dark:text-green-400\">Currently Tracking</div>\r\n          </div>\r\n          <div className=\"text-lg font-bold mt-1\">\r\n            {activeTask.title}\r\n          </div>\r\n        </Card>\r\n      )}\r\n\r\n      {/* Task List */}\r\n      <div className=\"space-y-2\">\r\n        {tasks.map(task => (\r\n           <Card \r\n             key={task.id}\r\n             className={cn(\r\n               \"p-3 flex items-center justify-between cursor-pointer transition-all hover:shadow-md\",\r\n               activeTask?.id === task.id \r\n                 ? \"border-2 border-green-500/50 bg-green-500/5 shadow-md\" \r\n                 : \"bg-card/60 hover:bg-card/80 border-border/50\",\r\n               task.completed && \"opacity-60 grayscale\"\r\n             )}\r\n             onClick={() => onActiveTaskChange(task)}\r\n           >\r\n             <div className=\"flex items-center space-x-3 overflow-hidden flex-1\">\r\n                <button \r\n                  onClick={(e) => { e.stopPropagation(); toggleTask(task); }}\r\n                  className={cn(\r\n                    \"h-6 w-6 rounded-full border-2 flex items-center justify-center transition-colors shrink-0\",\r\n                    task.completed ? \"bg-primary border-primary text-primary-foreground\" : \"border-muted-foreground/30 hover:border-primary\"\r\n                  )}\r\n                >\r\n                  {task.completed && <Check className=\"h-4 w-4\" />}\r\n                </button>\r\n                <span className={cn(\"font-medium truncate\", task.completed && \"line-through text-muted-foreground\")}>\r\n                  {task.title}\r\n                </span>\r\n             </div>\r\n             \r\n             <div className=\"flex items-center space-x-1 text-muted-foreground text-sm shrink-0\">\r\n               <span className=\"mr-2 font-mono\">{task.actPomodoros}/{task.estPomodoros} ≡ƒìà</span>\r\n               \r\n               <Button\r\n                variant=\"ghost\"\r\n                size=\"icon\"\r\n                className=\"h-8 w-8 hover:text-primary\"\r\n                onClick={(e) => { e.stopPropagation(); startEditing(task); }}\r\n               >\r\n                 <Edit2 className=\"h-3.5 w-3.5\" />\r\n               </Button>\r\n\r\n               <Button \r\n                variant=\"ghost\" \r\n                size=\"icon\" \r\n                className=\"h-8 w-8 hover:text-destructive\"\r\n                onClick={(e) => { e.stopPropagation(); deleteTask(task.id); }}\r\n               >\r\n                 <Trash className=\"h-3.5 w-3.5\" />\r\n               </Button>\r\n             </div>\r\n           </Card>\r\n        ))}\r\n        {tasks.length === 0 && (\r\n          <Card className=\"p-8 text-center border-2 border-dashed border-primary/30 bg-primary/5\">\r\n            <div className=\"text-4xl mb-2\">≡ƒô¥</div>\r\n            <div className=\"font-medium text-foreground\">No tasks yet</div>\r\n            <div className=\"text-sm text-muted-foreground mt-1\">\r\n              Add a task above to track your pomodoros!\r\n            </div>\r\n          </Card>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\reina\\antigravity\\pomodoro\\client\\src\\components\\ThemeProvider.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\reina\\antigravity\\pomodoro\\client\\src\\components\\ThemeProvider.tsx:49:7\n  47 |     \n  48 |     if (savedDark !== null) {\n> 49 |       setIsDark(savedDark === 'true');\n     |       ^^^^^^^^^ Avoid calling setState() directly within an effect\n  50 |     } else {\n  51 |       const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;\n  52 |       setIsDark(prefersDark);","line":49,"column":7,"nodeType":null,"endLine":49,"endColumn":16}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { createContext, useContext, useState, useEffect, useCallback } from 'react';\r\n\r\ninterface ModeColors {\r\n  pomodoro: string; // HSL hue (0-360)\r\n  shortBreak: string;\r\n  longBreak: string;\r\n}\r\n\r\ninterface ThemeContextType {\r\n  isDark: boolean;\r\n  toggleDarkMode: () => void;\r\n  modeColors: ModeColors;\r\n  setModeColor: (mode: keyof ModeColors, hue: string) => void;\r\n}\r\n\r\nconst DEFAULT_COLORS: ModeColors = {\r\n  pomodoro: '350', // Rose/Red\r\n  shortBreak: '160', // Teal\r\n  longBreak: '210', // Blue\r\n};\r\n\r\nconst ThemeContext = createContext<ThemeContextType | null>(null);\r\n\r\nexport function useTheme() {\r\n  const context = useContext(ThemeContext);\r\n  if (!context) {\r\n    throw new Error('useTheme must be used within a ThemeProvider');\r\n  }\r\n  return context;\r\n}\r\n\r\ninterface ThemeProviderProps {\r\n  children: React.ReactNode;\r\n}\r\n\r\nexport function ThemeProvider({ children }: ThemeProviderProps) {\r\n  const [isDark, setIsDark] = useState(true);\r\n  const [modeColors, setModeColors] = useState<ModeColors>(DEFAULT_COLORS);\r\n  const [mounted, setMounted] = useState(false);\r\n\r\n  // Load preferences on mount\r\n  useEffect(() => {\r\n    const savedDark = localStorage.getItem('darkMode');\r\n    const savedColors = localStorage.getItem('modeColors');\r\n    \r\n    if (savedDark !== null) {\r\n      setIsDark(savedDark === 'true');\r\n    } else {\r\n      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;\r\n      setIsDark(prefersDark);\r\n    }\r\n    \r\n    if (savedColors !== null) {\r\n      try {\r\n        const parsed = JSON.parse(savedColors);\r\n        setModeColors({ ...DEFAULT_COLORS, ...parsed });\r\n      } catch (e) {\r\n        console.error('Failed to load mode colors', e);\r\n      }\r\n    }\r\n    \r\n    setMounted(true);\r\n  }, []);\r\n\r\n  // Apply theme to document\r\n  useEffect(() => {\r\n    if (!mounted) return;\r\n    \r\n    const root = document.documentElement;\r\n    \r\n    if (isDark) {\r\n      root.classList.add('dark');\r\n    } else {\r\n      root.classList.remove('dark');\r\n    }\r\n    \r\n    localStorage.setItem('darkMode', String(isDark));\r\n  }, [isDark, mounted]);\r\n\r\n  // Apply mode colors as CSS variables\r\n  useEffect(() => {\r\n    if (!mounted) return;\r\n    \r\n    const root = document.documentElement;\r\n    \r\n    root.style.setProperty('--pomodoro-hue', modeColors.pomodoro);\r\n    root.style.setProperty('--short-break-hue', modeColors.shortBreak);\r\n    root.style.setProperty('--long-break-hue', modeColors.longBreak);\r\n    \r\n    localStorage.setItem('modeColors', JSON.stringify(modeColors));\r\n  }, [modeColors, mounted]);\r\n\r\n  const toggleDarkMode = useCallback(() => {\r\n    setIsDark(prev => !prev);\r\n  }, []);\r\n\r\n  const setModeColor = useCallback((mode: keyof ModeColors, hue: string) => {\r\n    setModeColors(prev => {\r\n      const updated = { ...prev, [mode]: hue };\r\n      // Also dispatch event so Timer can pick up changes immediately\r\n      window.dispatchEvent(new CustomEvent('themeChanged'));\r\n      return updated;\r\n    });\r\n  }, []);\r\n\r\n  if (!mounted) {\r\n    return <div style={{ visibility: 'hidden' }}>{children}</div>;\r\n  }\r\n\r\n  return (\r\n    <ThemeContext.Provider value={{ isDark, toggleDarkMode, modeColors, setModeColor }}>\r\n      {children}\r\n    </ThemeContext.Provider>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\reina\\antigravity\\pomodoro\\client\\src\\components\\Timer.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cn' is defined but never used.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":144,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4807,4810],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4807,4810],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'playAlarm' is assigned a value but never used.","line":204,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":204,"endColumn":18},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":208,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":208,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6771,6774],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6771,6774],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getModeHue' is assigned a value but never used.","line":248,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":248,"endColumn":19}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card } from \"@/components/ui/card\";\r\nimport { useTimer } from \"@/hooks/useTimer\";\r\nimport { Play, Pause, Volume2, VolumeX, RotateCcw } from \"lucide-react\";\r\nimport { useEffect, useState, useCallback, useRef } from \"react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { useApiClient } from \"@/lib/apiClient\";\r\nimport { useAuth } from \"@/components/auth/AuthProvider\";\r\nimport { useTheme } from \"@/components/ThemeProvider\";\r\nimport { AlarmSound, playAlarmSound } from \"@/lib/alarmSounds\";\r\n\r\ninterface TimerSettings {\r\n  pomodoro: number;\r\n  shortBreak: number;\r\n  longBreak: number;\r\n}\r\n\r\ninterface Task {\r\n  id: number;\r\n  title: string;\r\n}\r\n\r\ninterface TimerProps {\r\n  activeTask: Task | null;\r\n}\r\n\r\nconst DEFAULT_SETTINGS: TimerSettings = {\r\n  pomodoro: 25 * 60,\r\n  shortBreak: 5 * 60,\r\n  longBreak: 15 * 60,\r\n};\r\n\r\nexport function Timer({ activeTask }: TimerProps) {\r\n  const apiClient = useApiClient();\r\n  const { user } = useAuth();\r\n  const { modeColors } = useTheme();\r\n  const [settings, setSettings] = useState<TimerSettings>(DEFAULT_SETTINGS);\r\n  const [soundEnabled, setSoundEnabled] = useState(true);\r\n  const [brownNoiseEnabled, setBrownNoiseEnabled] = useState(false);\r\n  const [alarmSettings, setAlarmSettings] = useState<{ pomodoro: AlarmSound; shortBreak: AlarmSound; longBreak: AlarmSound }>({\r\n    pomodoro: 'beep',\r\n    shortBreak: 'chime',\r\n    longBreak: 'bell',\r\n  });\r\n  \r\n  // Brown noise audio refs\r\n  const audioContextRef = useRef<AudioContext | null>(null);\r\n  const brownNoiseNodeRef = useRef<AudioBufferSourceNode | null>(null);\r\n  const gainNodeRef = useRef<GainNode | null>(null);\r\n\r\n  // Load settings from localStorage on mount and listen for changes\r\n  useEffect(() => {\r\n    const loadSettings = () => {\r\n      const saved = localStorage.getItem('timerSettings');\r\n      if (saved) {\r\n        try {\r\n          const parsed = JSON.parse(saved);\r\n          setSettings(parsed);\r\n        } catch (e) {\r\n          console.error('Failed to parse saved settings', e);\r\n        }\r\n      }\r\n      const brownNoisePref = localStorage.getItem('brownNoiseEnabled');\r\n      if (brownNoisePref !== null) {\r\n        setBrownNoiseEnabled(brownNoisePref === 'true');\r\n      }\r\n      const savedAlarms = localStorage.getItem('alarmSettings');\r\n      if (savedAlarms) {\r\n        try {\r\n          setAlarmSettings(prev => ({ ...prev, ...JSON.parse(savedAlarms) }));\r\n        } catch (e) {\r\n          console.error('Failed to parse alarm settings', e);\r\n        }\r\n      }\r\n    };\r\n    \r\n    loadSettings();\r\n    \r\n    // Listen for settings changes from SettingsDialog\r\n    const handleSettingsChange = () => loadSettings();\r\n    window.addEventListener('settingsChanged', handleSettingsChange);\r\n    window.addEventListener('storage', handleSettingsChange);\r\n    \r\n    return () => {\r\n      window.removeEventListener('settingsChanged', handleSettingsChange);\r\n      window.removeEventListener('storage', handleSettingsChange);\r\n    };\r\n  }, []);\r\n\r\n  // Log session to API when timer completes\r\n  const logSession = useCallback(async (timerMode: string) => {\r\n    if (!user) return;\r\n    \r\n    const duration = timerMode === 'pomodoro' ? Math.round(settings.pomodoro / 60)\r\n                   : timerMode === 'shortBreak' ? Math.round(settings.shortBreak / 60)\r\n                   : Math.round(settings.longBreak / 60);\r\n    \r\n    try {\r\n      await apiClient.post('/sessions', {\r\n        taskId: activeTask?.id || null,\r\n        type: timerMode,\r\n        duration,\r\n      });\r\n      console.log(`Session logged: ${timerMode}, ${duration}min, task: ${activeTask?.title || 'none'}`);\r\n    } catch (err) {\r\n      console.error('Failed to log session:', err);\r\n    }\r\n  }, [apiClient, user, activeTask, settings]);\r\n\r\n  const handleTimerComplete = useCallback((completedMode: string) => {\r\n    // Play the alarm sound for the completed mode\r\n    if (soundEnabled) {\r\n      const sound = completedMode === 'pomodoro' ? alarmSettings.pomodoro\r\n                  : completedMode === 'shortBreak' ? alarmSettings.shortBreak\r\n                  : alarmSettings.longBreak;\r\n      playAlarmSound(sound);\r\n    }\r\n    logSession(completedMode);\r\n  }, [logSession, soundEnabled, alarmSettings]);\r\n\r\n  const { \r\n    mode, \r\n    timeLeft, \r\n    isRunning, \r\n    startTimer, \r\n    pauseTimer, \r\n    resetTimer,\r\n    switchMode,\r\n    progress\r\n  } = useTimer({\r\n    pomodoroTime: settings.pomodoro,\r\n    shortBreakTime: settings.shortBreak,\r\n    longBreakTime: settings.longBreak,\r\n    onComplete: handleTimerComplete,\r\n  });\r\n\r\n  // Brown noise generator\r\n  const startBrownNoise = useCallback(() => {\r\n    if (audioContextRef.current) return;\r\n    \r\n    try {\r\n      const audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\r\n      audioContextRef.current = audioContext;\r\n      \r\n      const bufferSize = audioContext.sampleRate * 2;\r\n      const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);\r\n      const data = buffer.getChannelData(0);\r\n      \r\n      let lastOut = 0;\r\n      for (let i = 0; i < bufferSize; i++) {\r\n        const white = Math.random() * 2 - 1;\r\n        data[i] = (lastOut + 0.02 * white) / 1.02;\r\n        lastOut = data[i];\r\n        data[i] *= 3.5;\r\n      }\r\n      \r\n      const source = audioContext.createBufferSource();\r\n      source.buffer = buffer;\r\n      source.loop = true;\r\n      \r\n      const gainNode = audioContext.createGain();\r\n      gainNode.gain.value = 0.3;\r\n      \r\n      source.connect(gainNode);\r\n      gainNode.connect(audioContext.destination);\r\n      source.start();\r\n      \r\n      brownNoiseNodeRef.current = source;\r\n      gainNodeRef.current = gainNode;\r\n    } catch (e) {\r\n      console.error('Failed to start brown noise:', e);\r\n    }\r\n  }, []);\r\n\r\n  const stopBrownNoise = useCallback(() => {\r\n    if (brownNoiseNodeRef.current) {\r\n      brownNoiseNodeRef.current.stop();\r\n      brownNoiseNodeRef.current = null;\r\n    }\r\n    if (audioContextRef.current) {\r\n      audioContextRef.current.close();\r\n      audioContextRef.current = null;\r\n    }\r\n    gainNodeRef.current = null;\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (isRunning && brownNoiseEnabled) {\r\n      startBrownNoise();\r\n    } else {\r\n      stopBrownNoise();\r\n    }\r\n    return () => stopBrownNoise();\r\n  }, [isRunning, brownNoiseEnabled, startBrownNoise, stopBrownNoise]);\r\n\r\n  const formatTime = (seconds: number) => {\r\n    const m = Math.floor(seconds / 60);\r\n    const s = seconds % 60;\r\n    return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;\r\n  };\r\n\r\n  const playAlarm = () => {\r\n    if (!soundEnabled) return;\r\n    \r\n    try {\r\n      const audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\r\n      \r\n      const playBeep = (startTime: number) => {\r\n        const oscillator = audioContext.createOscillator();\r\n        const gainNode = audioContext.createGain();\r\n        \r\n        oscillator.connect(gainNode);\r\n        gainNode.connect(audioContext.destination);\r\n        \r\n        oscillator.frequency.value = 600;\r\n        oscillator.type = 'sine';\r\n        \r\n        gainNode.gain.setValueAtTime(0, startTime);\r\n        gainNode.gain.linearRampToValueAtTime(0.5, startTime + 0.01);\r\n        gainNode.gain.linearRampToValueAtTime(0, startTime + 0.2);\r\n        \r\n        oscillator.start(startTime);\r\n        oscillator.stop(startTime + 0.2);\r\n      };\r\n      \r\n      const now = audioContext.currentTime;\r\n      playBeep(now);\r\n      playBeep(now + 0.5);\r\n      playBeep(now + 1.0);\r\n      \r\n      setTimeout(() => audioContext.close(), 2000);\r\n    } catch (e) {\r\n      console.log('Audio play failed', e);\r\n    }\r\n  };\r\n\r\n  // Get current mode's color hue\r\n  const getCurrentHue = () => {\r\n    switch (mode) {\r\n      case 'pomodoro': return modeColors.pomodoro;\r\n      case 'shortBreak': return modeColors.shortBreak;\r\n      case 'longBreak': return modeColors.longBreak;\r\n    }\r\n  };\r\n\r\n  const getModeHue = (m: string) => {\r\n    switch (m) {\r\n      case 'pomodoro': return modeColors.pomodoro;\r\n      case 'shortBreak': return modeColors.shortBreak;\r\n      case 'longBreak': return modeColors.longBreak;\r\n      default: return '350';\r\n    }\r\n  };\r\n\r\n  const currentHue = getCurrentHue();\r\n\r\n  return (\r\n    <div className=\"flex flex-col items-center w-full max-w-md mx-auto space-y-8\">\r\n      {/* Mode Switcher */}\r\n      <div className=\"flex p-1 space-x-1 rounded-full bg-secondary/50 backdrop-blur-sm border border-border/50\">\r\n        <Button\r\n          variant={mode === 'pomodoro' ? \"default\" : \"ghost\"}\r\n          size=\"sm\"\r\n          onClick={() => switchMode('pomodoro')}\r\n          className=\"rounded-full transition-all\"\r\n          style={mode === 'pomodoro' ? { backgroundColor: `hsl(${modeColors.pomodoro}, 70%, 50%)` } : {}}\r\n        >\r\n          Pomodoro\r\n        </Button>\r\n        <Button\r\n          variant={mode === 'shortBreak' ? \"default\" : \"ghost\"}\r\n          size=\"sm\"\r\n          onClick={() => switchMode('shortBreak')}\r\n          className=\"rounded-full transition-all\"\r\n          style={mode === 'shortBreak' ? { backgroundColor: `hsl(${modeColors.shortBreak}, 70%, 50%)` } : {}}\r\n        >\r\n          Short Break\r\n        </Button>\r\n        <Button\r\n          variant={mode === 'longBreak' ? \"default\" : \"ghost\"}\r\n          size=\"sm\"\r\n          onClick={() => switchMode('longBreak')}\r\n          className=\"rounded-full transition-all\"\r\n          style={mode === 'longBreak' ? { backgroundColor: `hsl(${modeColors.longBreak}, 70%, 50%)` } : {}}\r\n        >\r\n          Long Break\r\n        </Button>\r\n      </div>\r\n\r\n      {/* Main Timer Display */}\r\n      <Card \r\n        className=\"w-full aspect-square flex flex-col items-center justify-center relative overflow-hidden transition-all duration-500 border-2 backdrop-blur-xl shadow-2xl rounded-[3rem]\"\r\n        style={{\r\n          backgroundColor: `hsla(${currentHue}, 70%, 50%, 0.1)`,\r\n          borderColor: `hsla(${currentHue}, 70%, 50%, 0.5)`,\r\n          color: `hsl(${currentHue}, 70%, 55%)`,\r\n        }}\r\n      >\r\n        {/* Progress Background */}\r\n        <div \r\n          className=\"absolute bottom-0 left-0 w-full transition-all duration-1000 ease-linear\"\r\n          style={{ \r\n            height: `${progress * 100}%`,\r\n            backgroundColor: `hsla(${currentHue}, 70%, 50%, 0.1)`,\r\n          }}\r\n        />\r\n\r\n        <div className=\"z-10 flex flex-col items-center space-y-6\">\r\n          <div className=\"text-8xl font-bold tracking-tighter tabular-nums select-none animate-in fade-in zoom-in duration-500\">\r\n            {formatTime(timeLeft)}\r\n          </div>\r\n          \r\n          <div className=\"flex items-center space-x-4\">\r\n             <Button\r\n                size=\"icon\"\r\n                variant=\"outline\"\r\n                className=\"h-12 w-12 rounded-full border-2 text-current hover:bg-current/10 hover:text-current transition-all opacity-70 hover:opacity-100\"\r\n                onClick={resetTimer}\r\n                title=\"Restart Timer\"\r\n             >\r\n                <RotateCcw className=\"h-5 w-5\" />\r\n             </Button>\r\n             <Button\r\n                size=\"icon\"\r\n                variant=\"outline\"\r\n                className=\"h-16 w-16 rounded-full border-2 text-current hover:bg-current/10 hover:text-current transition-all\"\r\n                onClick={isRunning ? pauseTimer : startTimer}\r\n             >\r\n                {isRunning ? (\r\n                  <Pause className=\"h-8 w-8 fill-current\" />\r\n                ) : (\r\n                  <Play className=\"h-8 w-8 fill-current ml-1\" />\r\n                )}\r\n             </Button>\r\n          </div>\r\n          \r\n          {/* Active Task Display */}\r\n          {activeTask && (\r\n            <div className=\"text-center mt-2 px-4\">\r\n              <p className=\"text-sm opacity-70\">Working on</p>\r\n              <p className=\"text-lg font-medium truncate max-w-[280px]\">{activeTask.title}</p>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Sound Toggle */}\r\n        <div className=\"absolute top-6 right-6 flex space-x-2\">\r\n          <Button\r\n            variant=\"ghost\"\r\n            size=\"icon\"\r\n            onClick={() => setSoundEnabled(!soundEnabled)}\r\n            className=\"rounded-full hover:bg-current/10\"\r\n          >\r\n            {soundEnabled ? <Volume2 className=\"h-5 w-5\" /> : <VolumeX className=\"h-5 w-5\" />}\r\n          </Button>\r\n        </div>\r\n      </Card>\r\n      \r\n      <div className=\"text-muted-foreground text-sm font-medium tracking-widest uppercase opacity-50\">\r\n        {isRunning ? 'Stay Focused' : 'Ready to Start?'}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\reina\\antigravity\\pomodoro\\client\\src\\components\\auth\\AuthProvider.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'apiClient' is defined but never used.","line":5,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":17},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\reina\\antigravity\\pomodoro\\client\\src\\components\\auth\\AuthProvider.tsx:41:7\n  39 |\n  40 |     if (storedToken && storedUser) {\n> 41 |       setToken(storedToken);\n     |       ^^^^^^^^ Avoid calling setState() directly within an effect\n  42 |       setUser(JSON.parse(storedUser));\n  43 |     }\n  44 |     setLoading(false);","line":41,"column":7,"nodeType":null,"endLine":41,"endColumn":15}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { createContext, useContext, useEffect, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport apiClient from \"@/lib/apiClient\";\r\n\r\ninterface User {\r\n  id: string;\r\n  email: string;\r\n}\r\n\r\ninterface AuthContextType {\r\n  user: User | null;\r\n  token: string | null;\r\n  loading: boolean;\r\n  login: (token: string, user: User) => void;\r\n  logout: () => void;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType>({\r\n  user: null,\r\n  token: null,\r\n  loading: true,\r\n  login: () => {},\r\n  logout: () => {},\r\n});\r\n\r\nexport const useAuth = () => useContext(AuthContext);\r\n\r\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\r\n  const [user, setUser] = useState<User | null>(null);\r\n  const [token, setToken] = useState<string | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const router = useRouter();\r\n\r\n  useEffect(() => {\r\n    const storedToken = localStorage.getItem(\"token\");\r\n    const storedUser = localStorage.getItem(\"user\");\r\n\r\n    if (storedToken && storedUser) {\r\n      setToken(storedToken);\r\n      setUser(JSON.parse(storedUser));\r\n    }\r\n    setLoading(false);\r\n  }, []);\r\n\r\n  const login = (newToken: string, newUser: User) => {\r\n    localStorage.setItem(\"token\", newToken);\r\n    localStorage.setItem(\"user\", JSON.stringify(newUser));\r\n    setToken(newToken);\r\n    setUser(newUser);\r\n    router.refresh();\r\n  };\r\n\r\n  const logout = () => {\r\n    localStorage.removeItem(\"token\");\r\n    localStorage.removeItem(\"user\");\r\n    setToken(null);\r\n    setUser(null);\r\n    router.refresh(); // Refresh to update UI\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ user, token, loading, login, logout }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\reina\\antigravity\\pomodoro\\client\\src\\components\\auth\\LoginForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[830,833],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[830,833],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { useAuth } from \"@/components/auth/AuthProvider\";\r\nimport { useApiClient } from \"@/lib/apiClient\";\r\n\r\nexport function LoginForm() {\r\n  const [email, setEmail] = useState(\"\");\r\n  const [password, setPassword] = useState(\"\");\r\n  const [error, setError] = useState(\"\");\r\n  const { login } = useAuth();\r\n  const apiClient = useApiClient();\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setError(\"\");\r\n    try {\r\n      const res = await apiClient.post(\"/auth/login\", { email, password });\r\n      login(res.data.token, res.data.user);\r\n    } catch (err: any) {\r\n      setError(err.response?.data?.error || \"Login failed\");\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Card className=\"w-full max-w-sm backdrop-blur-md bg-card/50\">\r\n      <CardHeader>\r\n        <CardTitle>Login</CardTitle>\r\n      </CardHeader>\r\n      <CardContent>\r\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n          <Input\r\n            type=\"email\"\r\n            placeholder=\"Email\"\r\n            value={email}\r\n            onChange={(e) => setEmail(e.target.value)}\r\n            required\r\n          />\r\n          <Input\r\n            type=\"password\"\r\n            placeholder=\"Password\"\r\n            value={password}\r\n            onChange={(e) => setPassword(e.target.value)}\r\n            required\r\n          />\r\n          {error && <p className=\"text-sm text-destructive\">{error}</p>}\r\n          <Button type=\"submit\" className=\"w-full\">Log In</Button>\r\n        </form>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\reina\\antigravity\\pomodoro\\client\\src\\components\\auth\\RegisterForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[836,839],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[836,839],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { useAuth } from \"@/components/auth/AuthProvider\";\r\nimport { useApiClient } from \"@/lib/apiClient\";\r\n\r\nexport function RegisterForm() {\r\n  const [email, setEmail] = useState(\"\");\r\n  const [password, setPassword] = useState(\"\");\r\n  const [error, setError] = useState(\"\");\r\n  const { login } = useAuth();\r\n  const apiClient = useApiClient();\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setError(\"\");\r\n    try {\r\n      const res = await apiClient.post(\"/auth/register\", { email, password });\r\n      login(res.data.token, res.data.user);\r\n    } catch (err: any) {\r\n      setError(err.response?.data?.error || \"Registration failed\");\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Card className=\"w-full max-w-sm backdrop-blur-md bg-card/50\">\r\n      <CardHeader>\r\n        <CardTitle>Sign Up</CardTitle>\r\n      </CardHeader>\r\n      <CardContent>\r\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n          <Input\r\n            type=\"email\"\r\n            placeholder=\"Email\"\r\n            value={email}\r\n            onChange={(e) => setEmail(e.target.value)}\r\n            required\r\n          />\r\n          <Input\r\n            type=\"password\"\r\n            placeholder=\"Password\"\r\n            value={password}\r\n            onChange={(e) => setPassword(e.target.value)}\r\n            required\r\n          />\r\n          {error && <p className=\"text-sm text-destructive\">{error}</p>}\r\n          <Button type=\"submit\" className=\"w-full\">Create Account</Button>\r\n        </form>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\reina\\antigravity\\pomodoro\\client\\src\\components\\ui\\button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\reina\\antigravity\\pomodoro\\client\\src\\components\\ui\\card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\reina\\antigravity\\pomodoro\\client\\src\\components\\ui\\dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\reina\\antigravity\\pomodoro\\client\\src\\components\\ui\\input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\reina\\antigravity\\pomodoro\\client\\src\\components\\ui\\label.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\reina\\antigravity\\pomodoro\\client\\src\\components\\ui\\switch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\reina\\antigravity\\pomodoro\\client\\src\\components\\ui\\tabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\reina\\antigravity\\pomodoro\\client\\src\\hooks\\useTimer.ts","messages":[{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`tick` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\reina\\antigravity\\pomodoro\\client\\src\\hooks\\useTimer.ts:131:46\n  129 |       handleTimerComplete();\n  130 |     } else {\n> 131 |       rafRef.current = requestAnimationFrame(tick);\n      |                                              ^^^^ `tick` accessed before it is declared\n  132 |     }\n  133 |   }, [handleTimerComplete]);\n  134 |\n\nC:\\Users\\reina\\antigravity\\pomodoro\\client\\src\\hooks\\useTimer.ts:118:3\n  116 |   }, [mode, pomodoroCount, onComplete, getDuration]);\n  117 |\n> 118 |   const tick = useCallback(() => {\n      |   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 119 |     if (!endTimeRef.current) return;\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 120 |     \n      ΓÇª\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 132 |     }\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 133 |   }, [handleTimerComplete]);\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ `tick` is declared here\n  134 |\n  135 |   const startTimer = useCallback(() => {\n  136 |     if (isRunning) return;","line":131,"column":46,"nodeType":null,"endLine":131,"endColumn":50}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef, useCallback } from 'react';\r\n\r\ntype TimerMode = 'pomodoro' | 'shortBreak' | 'longBreak';\r\n\r\ninterface UseTimerProps {\r\n  pomodoroTime: number; // in seconds now\r\n  shortBreakTime: number; // in seconds\r\n  longBreakTime: number; // in seconds\r\n  onComplete?: (completedMode: string) => void;\r\n}\r\n\r\ninterface TimerState {\r\n  mode: TimerMode;\r\n  timeLeft: number;\r\n  hasStarted: boolean;\r\n  pomodoroCount: number;\r\n}\r\n\r\nconst TIMER_STATE_KEY = 'timerState';\r\n\r\nexport const useTimer = ({\r\n  pomodoroTime,\r\n  shortBreakTime,\r\n  longBreakTime,\r\n  onComplete,\r\n}: UseTimerProps) => {\r\n  // Load initial state from localStorage\r\n  const getInitialState = (): TimerState => {\r\n    if (typeof window === 'undefined') {\r\n      return { mode: 'pomodoro', timeLeft: pomodoroTime, hasStarted: false, pomodoroCount: 0 };\r\n    }\r\n    try {\r\n      const saved = localStorage.getItem(TIMER_STATE_KEY);\r\n      if (saved) {\r\n        const parsed = JSON.parse(saved);\r\n        return {\r\n          mode: parsed.mode || 'pomodoro',\r\n          timeLeft: parsed.timeLeft ?? pomodoroTime,\r\n          hasStarted: parsed.hasStarted ?? false,\r\n          pomodoroCount: parsed.pomodoroCount ?? 0,\r\n        };\r\n      }\r\n    } catch (e) {\r\n      console.error('Failed to load timer state', e);\r\n    }\r\n    return { mode: 'pomodoro', timeLeft: pomodoroTime, hasStarted: false, pomodoroCount: 0 };\r\n  };\r\n\r\n  const initialState = getInitialState();\r\n  const [mode, setMode] = useState<TimerMode>(initialState.mode);\r\n  const [timeLeft, setTimeLeft] = useState(initialState.timeLeft);\r\n  const [isRunning, setIsRunning] = useState(false);\r\n  const [pomodoroCount, setPomodoroCount] = useState(initialState.pomodoroCount);\r\n  const endTimeRef = useRef<number | null>(null);\r\n  const rafRef = useRef<number | null>(null);\r\n  const hasStartedRef = useRef(initialState.hasStarted);\r\n\r\n  // Save state to localStorage whenever it changes\r\n  useEffect(() => {\r\n    const state: TimerState = {\r\n      mode,\r\n      timeLeft,\r\n      hasStarted: hasStartedRef.current,\r\n      pomodoroCount,\r\n    };\r\n    localStorage.setItem(TIMER_STATE_KEY, JSON.stringify(state));\r\n  }, [mode, timeLeft, pomodoroCount]);\r\n\r\n  const getDuration = useCallback((currentMode: TimerMode) => {\r\n    switch (currentMode) {\r\n      case 'pomodoro': return pomodoroTime;\r\n      case 'shortBreak': return shortBreakTime;\r\n      case 'longBreak': return longBreakTime;\r\n    }\r\n  }, [pomodoroTime, shortBreakTime, longBreakTime]);\r\n\r\n  const switchMode = useCallback((newMode: TimerMode, autoStart: boolean = false) => {\r\n    setMode(newMode);\r\n    setTimeLeft(getDuration(newMode));\r\n    hasStartedRef.current = false;\r\n    if (!autoStart) {\r\n      setIsRunning(false);\r\n      endTimeRef.current = null;\r\n    }\r\n  }, [getDuration]);\r\n\r\n  const handleTimerComplete = useCallback(() => {\r\n    if (onComplete) onComplete(mode);\r\n\r\n    let nextMode: TimerMode;\r\n    \r\n    if (mode === 'pomodoro') {\r\n      const newCount = pomodoroCount + 1;\r\n      setPomodoroCount(newCount);\r\n      \r\n      if (newCount % 4 === 0) {\r\n        nextMode = 'longBreak';\r\n      } else {\r\n        nextMode = 'shortBreak';\r\n      }\r\n    } else {\r\n      nextMode = 'pomodoro';\r\n    }\r\n\r\n    setMode(nextMode);\r\n    const nextDuration = getDuration(nextMode);\r\n    setTimeLeft(nextDuration);\r\n    hasStartedRef.current = false;\r\n    \r\n    setTimeout(() => {\r\n      const now = Date.now();\r\n      endTimeRef.current = now + nextDuration * 1000;\r\n      hasStartedRef.current = true;\r\n      setIsRunning(true);\r\n    }, 500);\r\n  }, [mode, pomodoroCount, onComplete, getDuration]);\r\n\r\n  const tick = useCallback(() => {\r\n    if (!endTimeRef.current) return;\r\n    \r\n    const now = Date.now();\r\n    const remaining = Math.max(0, Math.ceil((endTimeRef.current - now) / 1000));\r\n    \r\n    setTimeLeft(remaining);\r\n\r\n    if (remaining <= 0) {\r\n      setIsRunning(false);\r\n      endTimeRef.current = null;\r\n      handleTimerComplete();\r\n    } else {\r\n      rafRef.current = requestAnimationFrame(tick);\r\n    }\r\n  }, [handleTimerComplete]);\r\n\r\n  const startTimer = useCallback(() => {\r\n    if (isRunning) return;\r\n    \r\n    const now = Date.now();\r\n    endTimeRef.current = now + timeLeft * 1000;\r\n    hasStartedRef.current = true;\r\n    setIsRunning(true);\r\n    rafRef.current = requestAnimationFrame(tick);\r\n  }, [isRunning, timeLeft, tick]);\r\n\r\n  const pauseTimer = useCallback(() => {\r\n    if (!isRunning) return;\r\n    \r\n    setIsRunning(false);\r\n    if (rafRef.current) cancelAnimationFrame(rafRef.current);\r\n    endTimeRef.current = null;\r\n  }, [isRunning]);\r\n\r\n  useEffect(() => {\r\n    if (!isRunning && !hasStartedRef.current) {\r\n      setTimeLeft(getDuration(mode));\r\n    }\r\n  }, [pomodoroTime, shortBreakTime, longBreakTime, getDuration, mode, isRunning]);\r\n\r\n  useEffect(() => {\r\n    if (isRunning && endTimeRef.current) {\r\n      rafRef.current = requestAnimationFrame(tick);\r\n    }\r\n    return () => {\r\n      if (rafRef.current) cancelAnimationFrame(rafRef.current);\r\n    };\r\n  }, [isRunning, tick]);\r\n\r\n  const resetTimer = useCallback(() => {\r\n    setIsRunning(false);\r\n    if (rafRef.current) cancelAnimationFrame(rafRef.current);\r\n    endTimeRef.current = null;\r\n    hasStartedRef.current = false;\r\n    setTimeLeft(getDuration(mode));\r\n  }, [getDuration, mode]);\r\n\r\n  return {\r\n    mode,\r\n    timeLeft,\r\n    isRunning,\r\n    startTimer,\r\n    pauseTimer,\r\n    resetTimer,\r\n    switchMode,\r\n    pomodoroCount,\r\n    progress: 1 - timeLeft / getDuration(mode),\r\n  };\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\reina\\antigravity\\pomodoro\\client\\src\\lib\\alarmSounds.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\reina\\antigravity\\pomodoro\\client\\src\\lib\\apiClient.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\reina\\antigravity\\pomodoro\\client\\src\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
